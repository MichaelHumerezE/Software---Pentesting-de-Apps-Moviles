@extends('administrador.admin')

@section('content')
    <div class="row">
        <div class="col-lg-12">
            <div class="card">
                <div class="card-body">
                    <div class="box box-default">
                        <div class="box-body">
                            <h3>LoginActivity.java </h3>
                            <br>
                            <pre id="code_block" class="enlighter-origin">package com.ntobjectives.hackazon.activity;
                
                import android.content.Intent;
                import android.content.SharedPreferences;
                import android.os.Bundle;
                import android.preference.PreferenceManager;
                import android.support.annotation.NonNull;
                import android.util.Log;
                import android.view.Menu;
                import android.view.View;
                import android.widget.Button;
                import android.widget.EditText;
                import android.widget.Toast;
                import com.google.gson.Gson;
                import com.google.gson.JsonSyntaxException;
                import com.ntobjectives.hackazon.R;
                import com.ntobjectives.hackazon.model.Auth;
                import com.ntobjectives.hackazon.network.AuthRequest;
                import com.ntobjectives.hackazon.provider.UserContract;
                import com.octo.android.robospice.persistence.exception.SpiceException;
                import com.octo.android.robospice.request.listener.RequestListener;
                /* loaded from: classes.dex */
                public class LoginActivity extends AbstractRootActivity {
                    public static final String TAG = "LoginActivity";
                    protected Button button;
                    protected String host;
                    protected EditText hostField;
                    protected String password;
                    protected EditText passwordField;
                    protected boolean refresh = false;
                    protected String token;
                    protected String username;
                    protected EditText usernameField;
                
                    @Override // com.ntobjectives.hackazon.activity.AbstractRootActivity, android.app.Activity
                    protected void onCreate(Bundle savedInstanceState) {
                        super.onCreate(savedInstanceState);
                        if (getIntent().getBooleanExtra("EXIT", false)) {
                            finish();
                        }
                        setContentView(R.layout.activity_login);
                        SharedPreferences pref = PreferenceManager.getDefaultSharedPreferences(this);
                        this.refresh = getIntent().getBooleanExtra("refresh", false);
                        if (!pref.getBoolean("first_time", true) &amp;&amp; !pref.getString("token", "").equals("") &amp;&amp; !this.refresh) {
                            startActivity(new Intent(this, MainActivity.class));
                        }
                        if (savedInstanceState != null) {
                            this.host = savedInstanceState.getString("host", pref.getString("host", ""));
                            this.username = savedInstanceState.getString(UserContract.Column.USERNAME, "");
                            this.password = savedInstanceState.getString(UserContract.Column.PASSWORD, "");
                        } else {
                            this.host = pref.getString("host", "");
                            this.username = pref.getString(UserContract.Column.USERNAME, "");
                            this.password = pref.getString(UserContract.Column.PASSWORD, "");
                        }
                        this.hostField = (EditText) findViewById(R.id.host);
                        this.usernameField = (EditText) findViewById(R.id.username);
                        this.passwordField = (EditText) findViewById(R.id.password);
                        this.button = (Button) findViewById(R.id.loginButton);
                        if (!this.host.equals("")) {
                            this.hostField.setText(this.host);
                        }
                        this.usernameField.setText(this.username);
                        this.passwordField.setText(this.password);
                        this.button.setOnClickListener(new View.OnClickListener() { // from class: com.ntobjectives.hackazon.activity.LoginActivity.1
                            @Override // android.view.View.OnClickListener
                            public void onClick(View v) {
                                LoginActivity.this.button.setEnabled(false);
                                LoginActivity.this.host = LoginActivity.this.hostField.getText().toString();
                                LoginActivity.this.username = LoginActivity.this.usernameField.getText().toString();
                                LoginActivity.this.password = LoginActivity.this.passwordField.getText().toString();
                                Log.d(LoginActivity.TAG, "Clicked with: username = " + LoginActivity.this.username + ", password = " + LoginActivity.this.password + ", host = " + LoginActivity.this.host);
                                AuthRequest req = new AuthRequest(LoginActivity.this, LoginActivity.this.host, LoginActivity.this.username, LoginActivity.this.password);
                                req.setRefresh(LoginActivity.this.refresh);
                                LoginActivity.this.getSpiceManager().execute(req, new AuthRequestListener(LoginActivity.this.host, LoginActivity.this.username, LoginActivity.this.password));
                            }
                        });
                    }
                
                    @Override // com.ntobjectives.hackazon.activity.AbstractRootActivity, android.app.Activity
                    public boolean onCreateOptionsMenu(Menu menu) {
                        getMenuInflater().inflate(R.menu.auth, menu);
                        return true;
                    }
                
                    @Override // android.app.Activity
                    protected void onSaveInstanceState(@NonNull Bundle outState) {
                        outState.putString("host", this.host);
                        outState.putString(UserContract.Column.USERNAME, this.username);
                        outState.putString(UserContract.Column.PASSWORD, this.password);
                        super.onSaveInstanceState(outState);
                    }
                
                    @Override // android.app.Activity
                    protected void onRestoreInstanceState(@NonNull Bundle savedInstanceState) {
                        super.onRestoreInstanceState(savedInstanceState);
                    }
                
                    @Override // com.ntobjectives.hackazon.activity.AbstractRootActivity, android.app.Activity
                    protected void onStart() {
                        super.onStart();
                    }
                
                    /* loaded from: classes.dex */
                    public final class AuthRequestListener implements RequestListener&lt;String&gt; {
                        protected String host;
                        protected String password;
                        protected String username;
                
                        public AuthRequestListener(String host, String username, String password) {
                            this.host = host;
                            this.username = username;
                            this.password = password;
                        }
                
                        @Override // com.octo.android.robospice.request.listener.RequestListener
                        public void onRequestFailure(SpiceException spiceException) {
                            Toast.makeText(LoginActivity.this, "Incorrect request.", 0).show();
                            LoginActivity.this.button.setEnabled(true);
                        }
                
                        @Override // com.octo.android.robospice.request.listener.RequestListener
                        public void onRequestSuccess(String response) {
                            Log.d(LoginActivity.TAG, response);
                            LoginActivity.this.button.setEnabled(true);
                            Gson gson = new Gson();
                            try {
                                Auth auth = (Auth) gson.fromJson(response, (Class&lt;Object&gt;) Auth.class);
                                LoginActivity.this.token = auth.token;
                                SharedPreferences prefs = PreferenceManager.getDefaultSharedPreferences(LoginActivity.this.getApplicationContext());
                                prefs.edit().putString("host", this.host).putString(UserContract.Column.USERNAME, this.username).putString(UserContract.Column.PASSWORD, this.password).putString("token", LoginActivity.this.token).putBoolean("first_time", false).apply();
                                Log.d(LoginActivity.TAG, "Token: " + LoginActivity.this.token);
                                Log.d(LoginActivity.TAG, "Host: " + this.host);
                                LoginActivity.this.startActivity(new Intent(LoginActivity.this, MainActivity.class));
                                LoginActivity.this.finish();
                            } catch (JsonSyntaxException e) {
                                Toast.makeText(LoginActivity.this, "Service response is invalid.", 0).show();
                            }
                        }
                    }
                }
                </pre>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
@endsection
